{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://firelock-builder.local/schemas/army-roster.json",
  "title": "Army Roster",
  "description": "Complete schema for an army faction roster including metadata and all units",
  "type": "object",
  "required": ["faction", "units"],
  "properties": {
    "faction": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique faction identifier (e.g., 'fsa', 'atom', 'rygo', 'ebon')"
        },
        "name": {
          "type": "string",
          "description": "Full faction name (e.g., 'Federal States-Army')"
        },
        "description": {
          "type": "string",
          "description": "Faction background or flavor text"
        },
        "version": {
          "type": "string",
          "description": "Rulebook or roster version"
        },
        "specialRules": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the faction-wide special rule"
              },
              "description": {
                "type": "string",
                "description": "Full text description of the special rule"
              }
            }
          },
          "description": "Faction-wide special rules"
        }
      }
    },
    "units": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "name", "category", "unitClass", "points", "stats"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for the unit"
          },
          "name": {
            "type": "string",
            "description": "Display name of the unit"
          },
          "category": {
            "type": "string",
            "enum": ["TACOMS", "Infantry", "Vehicles", "Aircraft", "Emplacements", "Support", "Scenario"],
            "description": "Main section header from army book (e.g., TACOMS, Infantry, Vehicles)"
          },
          "subcategory": {
            "type": "string",
            "description": "Subsection within category (e.g., Line Squads, Personnel Carriers, Main Battle Tanks)"
          },
          "descriptiveCategory": {
            "type": "string",
            "description": "Short descriptive text (e.g., 'Self-Propelled Howitzer', 'Main Battle Tank', 'Paratrooper Squad')"
          },
          "unitClass": {
            "type": "string",
            "enum": ["Inf", "Inf(S)", "Vec", "Vec(W)", "Vec(S)", "Vec(C)", "Vec(M)", "Vec(L)", "Vec(H)", "Air", "Air(CAP)", "Air(CAS)"],
            "description": "Unit class for PC capacity and game mechanics: Inf (team, 1 PC), Inf(S) (squad, 2 PC), Vec variants (W=wide, S=small, C=crew, M=medium, L=large, H=hovercraft)"
          },
          "points": {
            "oneOf": [
              {
                "type": "integer",
                "minimum": 0
              },
              {
                "type": "string",
                "pattern": "^\\d+/\\d+$"
              }
            ],
            "description": "Point cost of the unit, or alternative cost like '0/20' for conditional pricing"
          },
          "stats": {
            "type": "object",
            "required": ["movement", "quality"],
            "properties": {
              "height": {
                "type": "integer",
                "minimum": 0,
                "description": "Height value"
              },
              "movement": {
                "type": "integer",
                "minimum": 0,
                "description": "Movement value in inches"
              },
              "quality": {
                "oneOf": [
                  {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 6
                  },
                  {
                    "type": "string",
                    "enum": ["*"]
                  }
                ],
                "description": "Quality rating (lower is better), or '*' for drones"
              },
              "toughness": {
                "oneOf": [
                  {
                    "type": "object",
                    "properties": {
                      "front": {
                        "type": ["integer", "string"],
                        "description": "Front toughness value (number or special value like '1-')"
                      },
                      "side": {
                        "type": ["integer", "string"],
                        "description": "Side toughness value (number or special value like '1-')"
                      },
                      "rear": {
                        "type": ["integer", "string"],
                        "description": "Rear toughness value (number or special value like '1-')"
                      }
                    },
                    "description": "Directional toughness for ground units and helicopters"
                  },
                  {
                    "type": ["integer", "string"],
                    "description": "Single toughness value for planes (Air(CAP), Air(CAS))"
                  }
                ]
              },
              "evasion": {
                "type": "integer",
                "minimum": 0,
                "maximum": 6,
                "description": "Evasion stat for planes (Air(CAP), Air(CAS))"
              },
              "command": {
                "type": "integer",
                "minimum": 0
              },
              "capacity": {
                "type": "integer",
                "minimum": 0
              },
              "spottingDistance": {
                "type": "integer",
                "minimum": 0,
                "description": "Spotting distance in inches"
              }
            }
          },
          "specialRules": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name"],
              "properties": {
                "name": {
                  "type": "string"
                },
                "description": {
                  "type": "string"
                }
              }
            }
          },
          "description": {
            "type": "string",
            "description": "Unit special ability description or flavor text (e.g., 'All units targeted in Brigade (including self) lose all pin tokens.')"
          },
          "weapons": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Weapon name"
                },
                "target": {
                  "type": "string",
                  "description": "Valid targets: 'All' (all unit classes), 'Inf/Vec/Air' (specific classes), 'Gnd' (ground point + radius). Common to all shot types if not specified per shot."
                },
                "range": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Range in inches (common to all shot types if not specified per shot)"
                },
                "accuracy": {
                  "oneOf": [
                    {
                      "type": "integer",
                      "minimum": 1,
                      "maximum": 6,
                      "description": "Single accuracy value (legacy format)"
                    },
                    {
                      "type": "string",
                      "description": "String accuracy value (e.g., '++' for automatic hit, 'xx' for cannot hit)"
                    },
                    {
                      "type": "object",
                      "required": ["stationary", "moving"],
                      "properties": {
                        "stationary": {
                          "oneOf": [
                            {
                              "type": "integer",
                              "minimum": 1,
                              "maximum": 6
                            },
                            {
                              "type": "string"
                            }
                          ],
                          "description": "Accuracy when stationary (e.g., 4 for 4+, '++' for auto-hit, 'xx' for cannot hit)"
                        },
                        "moving": {
                          "oneOf": [
                            {
                              "type": "integer",
                              "minimum": 1,
                              "maximum": 6
                            },
                            {
                              "type": "string"
                            }
                          ],
                          "description": "Accuracy when moving (e.g., 5 for 5+, '++' for auto-hit, 'xx' for cannot hit)"
                        }
                      },
                      "description": "Dual accuracy values for stationary and moving"
                    }
                  ],
                  "description": "Accuracy value (common to all shot types if not specified per shot)"
                },
                "strength": {
                  "oneOf": [
                    {
                      "type": "integer",
                      "minimum": 0,
                      "description": "Single strength value"
                    },
                    {
                      "type": "string",
                      "description": "String strength value (e.g., '0+' for special cases)"
                    },
                    {
                      "type": "object",
                      "required": ["normal", "halfRange"],
                      "properties": {
                        "normal": {
                          "type": ["integer", "string"],
                          "description": "Strength at normal range (number or string like '0+')"
                        },
                        "halfRange": {
                          "type": ["integer", "string"],
                          "description": "Strength at half range or less (number or string like '0+')"
                        }
                      },
                      "description": "Dual strength values for normal and half range"
                    }
                  ],
                  "description": "Strength value (common to all shot types if not specified per shot)"
                },
                "dice": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Number of damage dice (common to all shot types if not specified per shot)"
                },
                "ammo": {
                  "type": ["integer", "null"],
                  "minimum": 0,
                  "description": "Ammo count shared across all shot types (null for unlimited)"
                },
                "specialRules": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Special rules common to all shot types"
                },
                "shotTypes": {
                  "type": "array",
                  "description": "Different ammo/shot types for this weapon. If present, represents the various ammunition types that can be used with this weapon.",
                  "items": {
                    "type": "object",
                    "required": ["name"],
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "Shot type name (e.g., 'HEAT', 'Sabot', 'Smoke')"
                      },
                      "target": {
                        "type": ["string", "null"],
                        "description": "Valid targets for this shot type (e.g., 'Vec', 'Inf/Vec', 'All', 'Gnd'). Omit or set to null to inherit from weapon."
                      },
                      "range": {
                        "type": ["integer", "null"],
                        "minimum": 0,
                        "description": "Range override for this shot type. Omit or set to null to inherit from weapon."
                      },
                      "accuracy": {
                        "oneOf": [
                          {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 6
                          },
                          {
                            "type": "string",
                            "description": "String accuracy value (e.g., '++' for automatic hit, 'xx' for cannot hit)"
                          },
                          {
                            "type": "object",
                            "required": ["stationary", "moving"],
                            "properties": {
                              "stationary": {
                                "oneOf": [
                                  {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 6
                                  },
                                  {
                                    "type": "string"
                                  }
                                ],
                                "description": "Accuracy when stationary (e.g., 4 for 4+, '++' for auto-hit, 'xx' for cannot hit)"
                              },
                              "moving": {
                                "oneOf": [
                                  {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 6
                                  },
                                  {
                                    "type": "string"
                                  }
                                ],
                                "description": "Accuracy when moving (e.g., 5 for 5+, '++' for auto-hit, 'xx' for cannot hit)"
                              }
                            }
                          },
                          {
                            "type": "null"
                          }
                        ],
                        "description": "Accuracy override for this shot type. Omit or set to null to inherit from weapon."
                      },
                      "strength": {
                        "oneOf": [
                          {
                            "type": "integer",
                            "minimum": 0
                          },
                          {
                            "type": "string",
                            "description": "String strength value (e.g., '0+' for special cases)"
                          },
                          {
                            "type": "object",
                            "required": ["normal", "halfRange"],
                            "properties": {
                              "normal": {
                                "type": ["integer", "string"],
                                "description": "Strength at normal range (number or string like '0+')"
                              },
                              "halfRange": {
                                "type": ["integer", "string"],
                                "description": "Strength at half range or less (number or string like '0+')"
                              }
                            }
                          },
                          {
                            "type": "null"
                          }
                        ],
                        "description": "Strength value for this shot type. Omit or set to null to inherit from weapon."
                      },
                      "dice": {
                        "type": ["integer", "null"],
                        "minimum": 0,
                        "description": "Number of damage dice override for this shot type. Omit or set to null to inherit from weapon."
                      },
                      "specialRules": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "description": "Special rules unique to this shot type"
                      }
                    }
                  }
                }
              }
            }
          },
          "options": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "description": {
                  "type": "string"
                },
                "points": {
                  "type": "integer"
                }
              }
            }
          }
        }
      }
    }
  }
}
